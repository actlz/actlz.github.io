(function(){function l(a){if(!a.dom_id&&!a.replaces.length)return g("set dom_id or replaces");(new Image).src="https://analytics.getaim.info/player?hit=script&sub=replace&description="+location.hostname;var e=a.kinopoisk_var;if(e=a.kinopoisk_id||e&&window[e])k(h+"/autochange/info/kinopoisk?id="+e,"kp "+e,a);else if(a.title){var b=h+"/autochange/info/link?title="+a.title.toLowerCase();b+=u(a,"year","charset","separator","season","episode");k(b,a.title,a)}else{e=document.title||document.getElementsByTagName("title")[0].innerHTML;
e=e.replace(/ /g," ");var d;for(d in a.templates){var c=a.templates[d];if(b=e.match(new RegExp(c.regexp,"i"))){var f=c.order;break}}b?(d=b[f[0]].toLowerCase())?(b=h+"/autochange/info/link?separator="+a.separator+"&title="+d+(b[f[1]]?"&year="+b[f[1]]:"")+(b[f[2]]?"&season="+b[f[2]]:"")+(b[f[3]]?"&episode="+b[f[3]]:""),k(b+"&charset="+a.charset,d,a)):g("no title"):g("templates isn't match")}}function m(a,e,b,d){var c=new XMLHttpRequest;c.open("GET",a);c.onreadystatechange=function(){if(4===c.readyState)if(204===
c.status)g(e+" not found"),d&&"function"==typeof d&&d();else{if(200!==c.status)return g("api request failed");b(JSON.parse(c.response))}};c.send()}function u(a){for(var e="",b,d=1;d<arguments.length;d++)b=arguments[d],a[b]&&(e+="&"+b+"="+a[b]);return e}function k(a,e,b){m(a,e,function(a){a=a.url;var c=b.frame_params;if(c){c=c.join("&");var d=~a.indexOf("?")?"&":"?";a=c?a+d+c:a}n(b.dom_id,a,b.width,b.height);p(b.replaces||[],a)},b.not_found_cb)}function n(a,e,b,d){if(a){var c=document.getElementById(a);
if(!c)return setTimeout(n.bind(null,a,e,b,d),50);var f=a="";b&&"0"!==b&&(a=' width="'+b+'"');d&&"0"!==d&&(f=' height="'+d+'"');c.innerHTML="<iframe "+a+f+' allowfullscreen allow="autoplay *; fullscreen"></iframe>';q(r(e),function(a){var b=c.getElementsByTagName("iframe")[0];b.contentDocument.write(a);b.contentDocument.close()})}}function p(a,e){if(a.length){for(var b=document.getElementsByTagName("iframe"),d=0;d<b.length;d++){var c=b[d],f=c.src.match(/https?:\/\/(.+?)\/.+/);f&&-1!==a.indexOf(f[1])&&
(c.src=e,t(c),q(r(e),function(a,b){return function(d){for(var c=document.createElement("iframe"),e=a.attributes,f=0;f<e.length;f++)"src"!==e[f].name&&c.setAttribute(e[f].name,e[f].value);a.parentElement.replaceChild(c,a);t(c);c.contentDocument.write(d);c.contentDocument.close();g(b+" replaced")}}(c,f[1])))}setTimeout(p.bind(null,a,e),100)}}function q(a,e){var b=new XMLHttpRequest;b.open("GET",a);b.onreadystatechange=function(){4===b.readyState&&(200===b.status||404===b.status&&b.response&&~b.response.indexOf("\u0412\u0438\u0434\u0435\u043e \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u043f\u043e \u043f\u0440\u043e\u0441\u044c\u0431\u0435 \u043f\u0440\u0430\u0432\u043e\u043e\u0431\u043b\u0430\u0434\u0430\u0442\u0435\u043b\u044f"))&&
e(b.response)};b.send()}function t(a){a.hasAttribute("allowfullscreen")&&(a.allowFullscreen=!0);a.setAttribute("allow","autoplay *; fullsreen");a.allow="autoplay *; fullsreen"}function r(a){if(!window.URL||!window.localStorage)return a;var e=new URL(a),b=e.searchParams;if(b.has("episode"))return a;var d=e.pathname.split("/").slice(-1)[0];if(+d!=d)return a;var c=(localStorage.getItem("vp"+d)||"").split(":");d=c[0];c=c[1];if(+d!=d||+c!=c||b.has("season")&&b.get("season")&&b.get("season")!=d)return a;
b.set("season",d);b.set("episode",c);return e.href}var h="https://api"+Date.now()+".ellinagraypel.com",g=console.log.bind(console,"[collaps]");window.COLLAPS_CONF?l(window.COLLAPS_CONF):m(h+"/autochange/settings/domain/","settings",l)})();
