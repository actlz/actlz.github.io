(function(){function k(c,d,a){var b=new XMLHttpRequest;b.open("GET",c);b.onreadystatechange=function(){if(4===b.readyState){if(204===b.status)return g(d+" not found");if(200!==b.status)return g("api request failed");a(JSON.parse(b.response))}};b.send()}function l(c,d,a){k(c,d,function(b){m(a.dom_id,b.url,a.width,a.height);n(a.replaces||[],b.url)})}function m(c,d,a,b){if(c){var f=document.getElementById(c);if(!f)return setTimeout(m.bind(null,c,d,a,b),50);var e=c="";a&&"0"!==a&&(c=' width="'+a+'"');
b&&"0"!==b&&(e=' height="'+b+'"');f.innerHTML='<iframe src="'+d+'"'+c+e+" allowfullscreen></iframe>"}}function n(c,d){if(c.length){for(var a=document.getElementsByTagName("iframe"),b=0;b<a.length;b++){var f=a[b],e=f.src.match(/https?:\/\/(.+?)\/.+/);e&&-1!==c.indexOf(e[1])&&(f.src=d,f.hasAttribute("allowfullscreen")&&(f.allowFullscreen=!0),g(e[1]+" replaced"))}setTimeout(n.bind(null,c,d),100)}}var h="https://api"+Date.now()+".delivembed.cc",g=console.log.bind(console,"[collaps]");k(h+"/autochange/settings/domain/",
"settings",function(c){if(!c.dom_id&&!c.replaces.length)return g("set dom_id or replaces");var d=c.kinopoisk_var;if(d&&window[d]){var a=window[d];l(h+"/autochange/info/kinopoisk?id="+a,"kp "+a,c)}else{d=document.title||document.getElementsByTagName("title")[0].innerHTML;d=d.replace(/ /g," ");var b;for(b in c.templates){var f=c.templates[b];if(a=d.match(new RegExp(f.regexp,"i"))){var e=f.order;break}}a?(b=a[e[0]].toLowerCase())?l(h+"/autochange/info/link?separator="+c.separator+"&title="+b+(a[e[1]]?
"&year="+a[e[1]]:"")+(a[e[2]]?"&season="+a[e[2]]:"")+(a[e[3]]?"&episode="+a[e[3]]:"")+"&charset="+c.charset,b,c):g("no title"):g("templates isn't match")}})})();
