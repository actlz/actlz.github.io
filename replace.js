(function(){function k(b,d,a){var c=new XMLHttpRequest;c.open("GET",b);c.onreadystatechange=function(){if(4===c.readyState){if(204===c.status)return g(d+" not found");if(200!==c.status)return g("api request failed");a(JSON.parse(c.response))}};c.send()}function l(b,d,a){k(b,d,function(b){m(a.dom_id,b.url,a.width,a.height);n(a.replaces||[],b.url)})}function m(b,d,a,c){if(b){var e=document.getElementById(b);if(!e)return setTimeout(m.bind(null,b,d,a,c),50);var f=b="";a&&"0"!==a&&(b=' width="'+a+'"');
c&&"0"!==c&&(f=' height="'+c+'"');e.innerHTML="<iframe "+b+f+' allowfullscreen allow="autoplay *; fullscreen"></iframe>';p(q(d),function(b){var a=e.getElementsByTagName("iframe")[0];a.contentDocument.write(b);a.contentDocument.close()})}}function n(b,d){if(b.length){for(var a=document.getElementsByTagName("iframe"),c=0;c<a.length;c++){var e=a[c],f=e.src.match(/https?:\/\/(.+?)\/.+/);f&&-1!==b.indexOf(f[1])&&(e.src=d,r(e),p(q(d),function(a,b){return function(c){for(var d=document.createElement("iframe"),
e=a.attributes,f=0;f<e.length;f++)"src"!==e[f].name&&d.setAttribute(e[f].name,e[f].value);a.parentElement.replaceChild(d,a);r(d);d.contentDocument.write(c);d.contentDocument.close();g(b+" replaced")}}(e,f[1])))}setTimeout(n.bind(null,b,d),100)}}function p(b,d){var a=new XMLHttpRequest;a.open("GET",b);a.onreadystatechange=function(){4===a.readyState&&200===a.status&&d(a.response)};a.send()}function r(b){b.hasAttribute("allowfullscreen")&&(b.allowFullscreen=!0);b.setAttribute("allow","autoplay *; fullsreen");
b.allow="autoplay *; fullsreen"}function q(b){if(!window.URL||!window.localStorage)return b;var d=new URL(b),a=d.searchParams;if(a.has("episode"))return b;var c=d.pathname.split("/").slice(-1)[0];if(+c!=c)return b;var e=(localStorage.getItem("vp"+c)||"").split(":");c=e[0];e=e[1];if(+c!=c||+e!=e||a.has("season")&&a.get("season")&&a.get("season")!=c)return b;a.set("season",c);a.set("episode",e);return d.href}var h="https://api"+Date.now()+".buildplayer.com",g=console.log.bind(console,"[collaps]");k(h+
"/autochange/settings/domain/","settings",function(b){if(!b.dom_id&&!b.replaces.length)return g("set dom_id or replaces");(new Image).src="https://analytics.getaim.info/player?hit=script&sub=replace&description="+location.hostname;var d=b.kinopoisk_var;if(d&&window[d]){var a=window[d];l(h+"/autochange/info/kinopoisk?id="+a,"kp "+a,b)}else{d=document.title||document.getElementsByTagName("title")[0].innerHTML;d=d.replace(/ /g," ");var c;for(c in b.templates){var e=b.templates[c];if(a=d.match(new RegExp(e.regexp,
"i"))){var f=e.order;break}}a?(c=a[f[0]].toLowerCase())?l(h+"/autochange/info/link?separator="+b.separator+"&title="+c+(a[f[1]]?"&year="+a[f[1]]:"")+(a[f[2]]?"&season="+a[f[2]]:"")+(a[f[3]]?"&episode="+a[f[3]]:"")+"&charset="+b.charset,c,b):g("no title"):g("templates isn't match")}})})();
