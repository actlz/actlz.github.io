(function(){function k(){window.COLLAPS_CONF?m(window.COLLAPS_CONF):n(g+"/autochange/settings/domain/","settings",m)}function m(a){if(!a.dom_id&&!a.replaces.length)return h("set dom_id or replaces");(new Image).src="https://analytics.getaim.info/player?hit=script&sub=replace&description="+location.hostname;var d=a.kinopoisk_var;if(d=a.kinopoisk_id||d&&window[d])l(g+"/autochange/info/kinopoisk?id="+d,"kp "+d,a);else if(a.title){var b=g+"/autochange/info/link?title="+a.title.toLowerCase();b+=v(a,"year",
"charset","separator","season","episode");l(b,a.title,a)}else{d=document.title||document.getElementsByTagName("title")[0].innerHTML;d=d.replace(/ /g," ");var e;for(e in a.templates){var c=a.templates[e];if(b=d.match(new RegExp(c.regexp,"i"))){var f=c.order;break}}b?(e=b[f[0]].toLowerCase())?(b=g+"/autochange/info/link?separator="+a.separator+"&title="+e+(b[f[1]]?"&year="+b[f[1]]:"")+(b[f[2]]?"&season="+b[f[2]]:"")+(b[f[3]]?"&episode="+b[f[3]]:""),l(b+"&charset="+a.charset,e,a)):h("no title"):h("templates isn't match")}}
function n(a,d,b,e){var c=new XMLHttpRequest;c.open("GET",a);c.onreadystatechange=function(){if(4===c.readyState)if(204===c.status)h(d+" not found"),e&&"function"==typeof e&&e();else{if(200!==c.status)return h("api request failed");b(JSON.parse(c.response))}};c.send()}function v(a){for(var d="",b,e=1;e<arguments.length;e++)b=arguments[e],a[b]&&(d+="&"+b+"="+a[b]);return d}function l(a,d,b){n(a,d,function(a){a=a.url;var c=b.frame_params;if(c){c=c.join("&");var e=~a.indexOf("?")?"&":"?";a=c?a+e+c:a}p(b.dom_id,
a,b.width,b.height);q(b.replaces||[],a)},b.not_found_cb)}function p(a,d,b,e){if(a){var c=document.getElementById(a);if(!c)return setTimeout(p.bind(null,a,d,b,e),50);var f=a="";b&&"0"!==b&&(a=' width="'+b+'"');e&&"0"!==e&&(f=' height="'+e+'"');"https://api.multikland.net"==g?c.innerHTML='<iframe src="'+d+'"'+a+f+' allowfullscreen allow="autoplay *; fullscreen"></iframe>':(c.innerHTML="<iframe "+a+f+' allowfullscreen allow="autoplay *; fullscreen"></iframe>',r(t(d),function(a){var b=c.getElementsByTagName("iframe")[0];
b.contentDocument.write(a);b.contentDocument.close()}))}}function q(a,d){if(a.length){for(var b=document.getElementsByTagName("iframe"),e=0;e<b.length;e++){var c=b[e],f=c.src.match(/https?:\/\/(.+?)\/.+/);f&&-1!==a.indexOf(f[1])&&(c.src=d,u(c),"https://api.multikland.net"!=g&&r(t(d),function(a,b){return function(e){for(var c=document.createElement("iframe"),d=a.attributes,f=0;f<d.length;f++)"src"!==d[f].name&&c.setAttribute(d[f].name,d[f].value);a.parentElement.replaceChild(c,a);u(c);c.contentDocument.write(e);
c.contentDocument.close();h(b+" replaced")}}(c,f[1])))}setTimeout(q.bind(null,a,d),100)}}function r(a,d){var b=new XMLHttpRequest;b.open("GET",a);b.onreadystatechange=function(){4===b.readyState&&(200===b.status||404===b.status&&b.response&&~b.response.indexOf("\u0412\u0438\u0434\u0435\u043e \u0437\u0430\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043e"))&&d(b.response)};b.send()}function u(a){a.hasAttribute("allowfullscreen")&&(a.allowFullscreen=!0);a.setAttribute("allow","autoplay *; fullsreen");
a.allow="autoplay *; fullsreen"}function t(a){if(!window.URL||!window.localStorage)return a;var d=new URL(a),b=d.searchParams;if(b.has("episode"))return a;var e=d.pathname.split("/").slice(-1)[0];if(+e!=e)return a;var c=(localStorage.getItem("vp"+e)||"").split(":");e=c[0];c=c[1];if(+e!=e||+c!=c||b.has("season")&&b.get("season")&&b.get("season")!=e)return a;b.set("season",e);b.set("episode",c);return d.href}var g="https://api"+Date.now()+".ellinagraypel.com",h=console.log.bind(console,"[collaps]");
~navigator.userAgent.indexOf("iPhone")&&window.fetch?fetch("https://api.multikland.net/ping/",{method:"head"}).then(function(){g="https://api.multikland.net";k()})["catch"](k):k()})();
