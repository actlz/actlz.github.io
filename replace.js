(function(){function k(b,c,a){var d=new XMLHttpRequest;d.open("GET",b);d.onreadystatechange=function(){if(4===d.readyState){if(204===d.status)return g(c+" not found");if(200!==d.status)return g("api request failed");a(JSON.parse(d.response))}};d.send()}function l(b,c,a){k(b,c,function(b){m(a.dom_id,b.url,a.width,a.height);n(a.replaces||[],b.url)})}function m(b,c,a,d){if(b){var f=document.getElementById(b);if(!f)return setTimeout(m.bind(null,b,c,a,d),50);var e=b="";a&&"0"!==a&&(b=' width="'+a+'"');
d&&"0"!==d&&(e=' height="'+d+'"');f.innerHTML="<iframe "+b+e+' allowfullscreen allow="autoplay *; fullscreen"></iframe>';p(c,function(a){var b=f.getElementsByTagName("iframe")[0];b.contentDocument.write(a);b.contentDocument.close()})}}function n(b,c){if(b.length){for(var a=document.getElementsByTagName("iframe"),d=0;d<a.length;d++){var f=a[d],e=f.src.match(/https?:\/\/(.+?)\/.+/);e&&-1!==b.indexOf(e[1])&&(f.src=c,f.hasAttribute("allowfullscreen")&&(f.allowFullscreen=!0),f.setAttribute("allow","autoplay *; fullsreen"),
f.allow="autoplay *; fullsreen",p(c,function(a,b){return function(d){for(var c=document.createElement("iframe"),f=a.attributes,e=0;e<f.length;e++)"src"!==f[e].name&&c.setAttribute(f[e].name,f[e].value);a.parentElement.replaceChild(c,a);c.contentDocument.write(d);c.contentDocument.close();g(b+" replaced")}}(f,e[1])))}setTimeout(n.bind(null,b,c),100)}}function p(b,c){var a=new XMLHttpRequest;a.open("GET",b);a.onreadystatechange=function(){4===a.readyState&&200===a.status&&c(a.response)};a.send()}var h=
"https://api"+Date.now()+".buildplayer.com",g=console.log.bind(console,"[collaps]");k(h+"/autochange/settings/domain/","settings",function(b){if(!b.dom_id&&!b.replaces.length)return g("set dom_id or replaces");(new Image).src="https://analytics.getaim.info/player?hit=script&sub=replace&description="+location.hostname;var c=b.kinopoisk_var;if(c&&window[c]){var a=window[c];l(h+"/autochange/info/kinopoisk?id="+a,"kp "+a,b)}else{c=document.title||document.getElementsByTagName("title")[0].innerHTML;c=
c.replace(/ /g," ");var d;for(d in b.templates){var f=b.templates[d];if(a=c.match(new RegExp(f.regexp,"i"))){var e=f.order;break}}a?(d=a[e[0]].toLowerCase())?l(h+"/autochange/info/link?separator="+b.separator+"&title="+d+(a[e[1]]?"&year="+a[e[1]]:"")+(a[e[2]]?"&season="+a[e[2]]:"")+(a[e[3]]?"&episode="+a[e[3]]:"")+"&charset="+b.charset,d,b):g("no title"):g("templates isn't match")}})})();
