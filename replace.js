(function(){function l(a){if(!a.dom_id&&!a.replaces.length)return g("set dom_id or replaces");(new Image).src="https://analytics.getaim.info/player?hit=script&sub=replace&description="+location.hostname;var c=a.kinopoisk_var;if(c=a.kinopoisk_id||c&&window[c])k(h+"/autochange/info/kinopoisk?id="+c,"kp "+c,a);else if(a.title){var b=h+"/autochange/info/link?title="+a.title.toLowerCase();b+=u(a,"year","charset","separator","season","episode");k(b,a.title,a)}else{c=document.title||document.getElementsByTagName("title")[0].innerHTML;
c=c.replace(/ /g," ");var d;for(d in a.templates){var e=a.templates[d];if(b=c.match(new RegExp(e.regexp,"i"))){var f=e.order;break}}b?(d=b[f[0]].toLowerCase())?(b=h+"/autochange/info/link?separator="+a.separator+"&title="+d+(b[f[1]]?"&year="+b[f[1]]:"")+(b[f[2]]?"&season="+b[f[2]]:"")+(b[f[3]]?"&episode="+b[f[3]]:""),k(b+"&charset="+a.charset,d,a)):g("no title"):g("templates isn't match")}}function m(a,c,b,d){var e=new XMLHttpRequest;e.open("GET",a);e.onreadystatechange=function(){if(4===e.readyState)if(204===
e.status)g(c+" not found"),d&&"function"==typeof d&&d();else{if(200!==e.status)return g("api request failed");b(JSON.parse(e.response))}};e.send()}function u(a){for(var c="",b,d=1;d<arguments.length;d++)b=arguments[d],a[b]&&(c+="&"+b+"="+a[b]);return c}function k(a,c,b){m(a,c,function(a){n(b.dom_id,a.url,b.width,b.height);p(b.replaces||[],a.url)},b.not_found_cb)}function n(a,c,b,d){if(a){var e=document.getElementById(a);if(!e)return setTimeout(n.bind(null,a,c,b,d),50);var f=a="";b&&"0"!==b&&(a=' width="'+
b+'"');d&&"0"!==d&&(f=' height="'+d+'"');e.innerHTML="<iframe "+a+f+' allowfullscreen allow="autoplay *; fullscreen"></iframe>';q(r(c),function(a){var b=e.getElementsByTagName("iframe")[0];b.contentDocument.write(a);b.contentDocument.close()})}}function p(a,c){if(a.length){for(var b=document.getElementsByTagName("iframe"),d=0;d<b.length;d++){var e=b[d],f=e.src.match(/https?:\/\/(.+?)\/.+/);f&&-1!==a.indexOf(f[1])&&(e.src=c,t(e),q(r(c),function(a,b){return function(d){for(var c=document.createElement("iframe"),
e=a.attributes,f=0;f<e.length;f++)"src"!==e[f].name&&c.setAttribute(e[f].name,e[f].value);a.parentElement.replaceChild(c,a);t(c);c.contentDocument.write(d);c.contentDocument.close();g(b+" replaced")}}(e,f[1])))}setTimeout(p.bind(null,a,c),100)}}function q(a,c){var b=new XMLHttpRequest;b.open("GET",a);b.onreadystatechange=function(){4===b.readyState&&200===b.status&&c(b.response)};b.send()}function t(a){a.hasAttribute("allowfullscreen")&&(a.allowFullscreen=!0);a.setAttribute("allow","autoplay *; fullsreen");
a.allow="autoplay *; fullsreen"}function r(a){if(!window.URL||!window.localStorage)return a;var c=new URL(a),b=c.searchParams;if(b.has("episode"))return a;var d=c.pathname.split("/").slice(-1)[0];if(+d!=d)return a;var e=(localStorage.getItem("vp"+d)||"").split(":");d=e[0];e=e[1];if(+d!=d||+e!=e||b.has("season")&&b.get("season")&&b.get("season")!=d)return a;b.set("season",d);b.set("episode",e);return c.href}var h="https://api"+Date.now()+".ellinagraypel.com",g=console.log.bind(console,"[collaps]");
window.COLLAPS_CONF?l(window.COLLAPS_CONF):m(h+"/autochange/settings/domain/","settings",l)})();
